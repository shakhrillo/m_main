from fastapi import FastAPI
from pydantic import BaseModel
from typing import Optional
from fastapi.middleware.cors import CORSMiddleware
import re

app = FastAPI()

def extract_lat_lng(url):
    # Regular expression to find latitude and longitude
    pattern = r'@(-?\d+\.\d+),(-?\d+\.\d+)'
    match = re.search(pattern, url)
    
    if match:
        lat = float(match.group(1))
        lng = float(match.group(2))
        return lat, lng
    else:
        return None, None

origins = [
    "*",
    "http://localhost",
    "http://localhost:8080",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

class Item(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    tax: Optional[float] = None

@app.get("/")
def read_root():
    return {"Hello": "World"}
 
@app.get("/border/gr/tr")
def read_border():

    latitude, longitude = extract_lat_lng('https://www.google.com/maps/place/Kap%C4%B1kule+S%C4%B1n%C4%B1r+Kap%C4%B1s%C4%B1+Gi%C5%9Feleri/@41.7147567,26.3481164,14.36z/data=!4m15!1m8!3m7!1s0x14caa7040068086b:0xe1ccfe98bc01b0d0!2zxLBzdGFuYnVsLCBUw7xya2l5ZQ!3b1!8m2!3d41.0082376!4d28.9783589!16zL20vMDk5NDlt!3m5!1s0x14b2d7617aaafb21:0x2d58cc7839a2021e!8m2!3d41.7147801!4d26.3626777!16s%2Fg%2F1yg6c_7hj?entry=ttu')

    return {
        "bg": [
            # Turkish side
            [41.7170165, 26.3510865],
            [41.9615911, 26.6056117],
            [41.9699, 27.4617132],
            # Greek side
            [41.3816866, 23.362519],
            [41.4442614, 23.8258677],
            [41.3656225, 25.0497788],
            [41.2657614, 25.4285904],
            [41.7578325, 26.1644242]




        ],
        "tr": [
          [
            41.7147801,
            26.3626777
          ], 
          [
            40.9330444,
            26.3292394
          ],
          # Bulgarian side
          [41.7147801, 26.3626777],
          [41.9581208, 26.6107862],
          [41.9671155, 27.458009],


          # Ferry
          [36.197874, 29.642389],
          [36.848883, 28.282014],
          [36.6359007, 29.1205012]

        ],
        "al": [
            # Greek side
            [39.912652, 20.3570092],
            [39.652155, 20.1598913],
            # only pass through
            [40.0687756, 20.4315154],
            [40.6228582, 21.0540615],
            [40.0746941, 20.6012473]
        ],
        "mkd": [
            # Greek side
            [40.9201261, 21.4165729],
            [41.1338288, 22.5489905],
            [41.1705506, 22.745268]


        ],
        "gr": [
            # Turkish side
            [
                40.9450997, 26.3107196
            ],
            [
                41.6509707, 26.4841666
            ],

            # Macedonian side
            [40.9160515, 21.4186403],
            [41.1276257, 22.5516536],
            [41.1771878, 22.7587158],



            # Albanian side
            [39.9113371, 20.3620367],
            [39.6517219, 20.1584744],
            [40.6229231, 21.0571596],
            [40.071009, 20.6035108],



            # Ferry Turkey side
            [36.150139, 29.592212],
            [36.446781, 28.232555],
            [36.6158102, 27.838529],
            [36.222060, 27.612792],


            # Bulgarian side
            [41.3759382, 23.3621084],
            [41.43267, 23.8278296],
            [41.2661389, 25.4321165],
            [41.5487846, 26.1793745],
            [41.7385112, 26.1685592]




        ],
        "view": [
            41.295418225,
            26.403274875
        ],
        "road": [
            [
          [
            41.7115516036815,
            26.353423662476416,
          ],
          [
            41.7050637655727,
            26.37930630623248,
          ],
          [
            41.68209560089673,
            26.419134011380123,
          ],
          [
            41.6859356642382,
            26.442966252395593,
          ],
          [
            41.65856488392981,
            26.535188166496,
          ],
          [
            41.592900569384426,
            26.598555962858086,
          ],
          [
            41.46024841027588,
            26.608580410977936,
          ],
          [
            41.36295829350411,
            26.627346950522224,
          ],
          [
            41.326383407884606,
            26.595795051664027,
          ],
          [
            41.318229295517966,
            26.5164344647485,
          ],
          [
            41.252574633730916,
            26.385531238897272,
          ],
          [
            41.24145504530074,
            26.34828595845164,
          ],
          [
            41.195290420362426,
            26.317495279646693,
          ],
          [
            41.087375010995515,
            26.31750704355437,
          ],
          [
            41.021082565726516,
            26.33766433067592,
          ],
          [
            40.931328189860636,
            26.340035770685716,
          ],
          [
            40.88948209846296,
            26.259347431884095,
          ],
          [
            40.8217198262615,
            26.187293891125563,
          ],
          [
            40.781905864291616,
            26.133116837145252,
          ],
          [
            40.73083592034726,
            26.10650235292138,
          ],
          [
            40.72692447323763,
            26.03944328122398,
          ],
          [
            40.72231136740248,
            26.021997454378067,
          ],
          [
            40.68721364188812,
            26.011911584046345,
          ]
        ],
            [
            [
                40.9450997,
                26.3107196,
            ],
            [
                40.94488773376426,
                26.311556768840205,
            ],
            [
                40.94490195788558,
                26.31367178600263,
            ],
            [
                40.944099503547335,
                26.315822749982317,
            ],
            [
                40.93998140615565,
                26.32053953210996,
            ],
            [
                40.93570700053988,
                26.325167229225542,
            ],
            [
                40.93527317049143,
                26.325703531274485,
            ],
            [
                40.9330444,
                26.3292394,
            ]
        ]],
        "border": [
            [
                40.93218983721016,
                26.294067130938004,
            ],
            [
                40.92980936948183,
                26.296260617532766,
            ],
            [
                40.92775450850107,
                26.299840449688276,
            ],
            [
                40.92744292907105,
                26.303239423855047,
            ],
            [
                40.92847302276945,
                26.30641202557038,
            ],
            [
                40.92980027056316,
                26.30807608980234,
            ],
            [
                40.934053993810835,
                26.310528767547737,
            ],
            [
                40.93603181504466,
                26.312723529989512,
            ],
            [
                40.939368078189915,
                26.317764001085635,
            ],
            [
                40.941996986534264,
                26.32273145464498,
            ],
            [
                40.943854213300966,
                26.32745437241553,
            ],
            [
                40.94432433916367,
                26.33044215233454,
            ],
            [
                40.94352323138571,
                26.334406799568484,
            ],
            [
                40.94367451502262,
                26.34507665020479,
            ]
        ]
    }

@app.get("/items/{item_id}")
def read_item(item_id: int, q: Optional[str] = None):
    return {"item_id": item_id, "q": q}

@app.post("/items/")
def create_item(item: Item):
    return item
