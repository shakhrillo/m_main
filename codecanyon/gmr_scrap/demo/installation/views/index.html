<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/shell.min.js"></script>
    <link rel="stylesheet" href="/css/index.css" />
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col">
          <h3 class="mt-3">Installation</h3>
          <p>
            Please enter your email and password to install the application.
          </p>
          <div class="card mb-3">
            <div class="card-body">
              <button class="btn btn-primary" id="dockerComposeAction">
                Run script
              </button>
              <button class="btn btn-primary" id="dockerComposeStart">
                Start script
              </button>
              <button class="btn btn-primary" id="dockerCheck">
                Check Docker
              </button>
              <pre><code class="shell" id="dockerCompose"></code></pre>
            </div>
          </div>
          <div class="card">
            <div class="card-header">Firebase Configuration</div>
            <div class="card-body">
              <form>
                <div class="mb-3">
                  <label for="firebaseConfig" class="form-label"
                    >Firebase</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="firebaseConfig"
                    aria-describedby="firebaseHelp"
                  />
                  <div id="firebaseHelp" class="form-text">
                    Firebase configuration object.
                  </div>
                </div>
                <button type="submit" class="btn btn-primary">Check</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>

    <script>
      const dockerComposeAction = document.querySelector(
        "#dockerComposeAction"
      );
      dockerComposeAction.addEventListener("click", async () => {
        dockerComposeAction.disabled = true;
        const response = await fetch("/docker-compose", {
          method: "POST",
        });
        const data = await response.json();
        console.log(data);
        dockerComposeAction.disabled = false;
      });

      const dockerComposeStart = document.querySelector("#dockerComposeStart");
      dockerComposeStart.addEventListener("click", async () => {
        dockerComposeStart.disabled = true;
        const response = await fetch("/docker-start", {
          method: "POST",
        });
        const data = await response.json();
        console.log(data);
        dockerComposeStart.disabled = false;
      });

      const dockerCheck = document.querySelector("#dockerCheck");
      dockerCheck.addEventListener("click", async () => {
        dockerCheck.disabled = true;
        const response = await fetch("/docker-check", {
          method: "POST",
        });
        const data = await response.json();
        console.log(data);
        dockerCheck.disabled = false;
      });

      const form = document.querySelector("form");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const firebaseConfig = document.querySelector("#firebaseConfig").value;
        const response = await fetch("/firebase", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ firebaseConfig }),
        });
        const data = await response.json();
        console.log(data);
      });
    </script>
    <script>
      let logs = "";
      hljs.highlightAll();
      const socket = io();

      socket.on("docker-compose", (data) => {
        logs += data;
        document.querySelector("#dockerCompose").textContent = logs;
      });
    </script>
  </body>
</html>
